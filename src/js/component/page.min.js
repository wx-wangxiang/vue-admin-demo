/**
 * Created by G510 on 2016/8/28.
 */
(function(){$.fn.pages=function(opts){var option=$.extend({currPage:0,pageLen:5,totleNum:0,form:false,spage:5,topPage:1,afterPage:1,callback:function(){return false;}},opts);return this.each(function(){var $page=$(this);function jumpTmp(n){return'<div style="display: inline-block;" class="d-pages-form form-inline ml10">到第 <input class="d-pages-form-input form-control input-sm" style="width:60px;" type="number" value="'+n+'" min="1" > 页 <a class="d-pages-form-btn btn btn-sm btn-primary" href="javascript:;">确定</a></div></div>'}
    function init(){pageSum();creatPage();setTimeout(function(){bind();},1);}
    function pageSum(){option.pageNum=parseInt(Math.ceil(option.totleNum/option.pageLen));}
    function creatPage(){var html="",pageHtml='',arr=[],i,len=0,num=parseInt(option.currPage),pageNum=option.pageNum,cs=0,inputNum=1,dot='<li class="disabled"><a href="javascript:;">...</a></li>',spage=option.spage,showPage=0;$page.empty().hide();if(!num||option.totleNum<=option.pageLen){return false;}
        $page.show();if(num<=1){html+='<li class="previous disabled"><a href="javascript:;">&laquo;</a></li>';}else{html+='<li class="previous"><a data-page="'+(num-1)+'" href="javascript:;">&laquo;</a></li>';}
        arr=listArr(num,pageNum,spage);len=arr.length;if(arr[0]>1){showPage=arr[0]<=option.topPage?arr[0]-1:option.topPage;for(i=1;i<=showPage;i++){html+='<li><a data-page="'+i+'" href="javascript:;">'+i+"</a></li>";}}
        if(arr[0]>option.topPage+1){html+=dot;}
        for(i=0;i<len;i++){if(arr[i]==num){html+='<li class="active"><a data-page="'+arr[i]+'" href="javascript:;">'+arr[i]+"</a></li>";}else{html+='<li><a data-page="'+arr[i]+'" href="javascript:;">'+arr[i]+"</a></li>";}}
        if(arr[len-1]<pageNum-option.afterPage){html+=dot;}
        if(arr[len-1]<pageNum){showPage=arr[len-1]>=pageNum-option.afterPage?pageNum-arr[len-1]:option.afterPage;for(i=pageNum-showPage+1;i<=pageNum;i++){html+='<li><a data-page="'+i+'" href="javascript:;">'+i+"</a></li>";}}
        if(num>=pageNum){html+='<li class="next disabled"><a href="javascript:;">&raquo;</a> </li>';}else{html+='<li class="next" ><a data-page="'+(num+1)+'" href="javascript:;">&raquo;</a></li>';}
        html='<ul class="pagination">'+html+'</ul>';if(option.form){inputNum=num+1;if(inputNum>pageNum){inputNum=pageNum;}
            pageHtml='<div class="form-group" style="float: left;">共<strong>'+option.totleNum+'</strong>条记录，第<strong>'+num+'</strong>/<strong>'+pageNum+'</strong>页 </div>';html='<div style="float: right;">'+html+jumpTmp(inputNum)+'</div>';html=pageHtml+html;}
        $page.append(html);if(option.form){$page.find('.d-pages-form-input').attr('max',pageNum);}}
    function selectItem(n){if(!n||n<1||n>option.pageNum){return;}
        option.currPage=n;option.callback(n);init();}
    function bind(){var $submit=$page.find('.d-pages-form-btn'),$input=$page.find('.d-pages-form-input'),page,v,num;$page.find("a").click(function(){page=parseInt($(this).attr('data-page'));selectItem(page);});if(option.form){$submit.bind('click',function(){selectItem($input.val());});$input.click(function(){$(this).select();});$input.bind('keyup',function(){v=parseInt($(this).val());num=option.pageNum;if(!v){v=1;}else{v=parseInt(v);if(v>num){v=num;}
        if(v<1){v=1}}
        $(this).val(v);});}}
    function listArr(page,totle,len){var arr=[],cs,i,flag=true;cs=parseInt(len/2);if(flag&&totle<=len){for(i=1;i<=totle;i++){arr.push(i);}
        flag=false;}
        if(flag&&page<=len-cs){for(i=1;i<=len;i++){arr.push(i);}
            flag=false;}
        if(flag&&page+cs>=totle){for(i=totle-len+1;i<=totle;i++){arr.push(i);}
            flag=false;}
        if(flag){for(i=page-cs;i<=page+cs;i++){arr.push(i);}}
        return arr;}
    init();});};})();